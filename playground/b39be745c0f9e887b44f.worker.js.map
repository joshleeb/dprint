{"version":3,"sources":["../webpack/bootstrap","../node_modules/@dprint/formatter/mod.js","formatter.worker.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","createImportObject","dprint","createFromBuffer","wasmModuleBuffer","wasmModule","WebAssembly","Module","createFromInstance","Instance","wasmInstance","wasmExports","get_plugin_schema_version","set_file_path","set_override_config","get_formatted_text","format","get_error_text","get_plugin_info","get_resolved_config","get_config_diagnostics","set_global_config","set_plugin_config","get_license_text","get_wasm_memory_buffer","get_wasm_memory_buffer_size","add_to_shared_bytes_from_buffer","set_buffer_with_shared_bytes","clear_shared_bytes","reset_config","pluginSchemaVersion","Error","bufferSize","configSet","setConfig","globalConfig","pluginConfig","getConfigDiagnostics","setConfigIfNotSet","length","JSON","parse","receiveString","getResolvedConfig","getPluginInfo","_a","pluginInfo","fileNames","getLicenseText","formatText","filePath","fileText","overrideConfig","sendString","stringify","responseCode","text","encodedText","TextEncoder","encode","index","writeCount","Math","min","wasmBuffer","getWasmBuffer","buffer","Uint8Array","readCount","TextDecoder","decode","pointer","memory","createStreaming","response","instantiateStreaming","globalThis","Deno","isResponse","arrayBuffer","then","getArrayBuffer","obj","instance","formatter","config","nextFormat","abortController","AbortController","setConfigSync","f","action","err","postError","doHandlingError","formatSync","result","message","postMessage","type","onmessage","e","data","url","abort","signal","fetch","newFormatter","info","catch","aborted","loadUrl","providedConfig"],"mappings":"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","file":"b39be745c0f9e887b44f.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/playground/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","\"use strict\";\n// Copyright 2020-2021 by David Sherret. All rights reserved.\n// This work is licensed under the terms of the MIT license.\n// For a copy, see <https://opensource.org/licenses/MIT>.\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createFromInstance = exports.createFromBuffer = exports.createStreaming = exports.createImportObject = void 0;\n/**\n * Creates the WebAssembly import object, if necessary.\n */\nfunction createImportObject() {\n    // for now, use an identity object\n    return {\n        dprint: {\n            \"host_clear_bytes\": () => { },\n            \"host_read_buffer\": () => { },\n            \"host_write_buffer\": () => { },\n            \"host_take_file_path\": () => { },\n            \"host_take_override_config\": () => { },\n            \"host_format\": () => 0,\n            \"host_get_formatted_text\": () => 0,\n            \"host_get_error_text\": () => 0, // zero length\n        },\n    };\n}\nexports.createImportObject = createImportObject;\n/**\n * Creates a formatter from the specified streaming source.\n * @remarks This is the most efficient way to create a formatter.\n * @param response - The streaming source to create the formatter from.\n */\nfunction createStreaming(response) {\n    // instantiateStreaming is not working in Deno (issue #309) and in newer versions\n    // it no longer exists on the `WebAssembly` object, so use an `any` type here.\n    if (\n    // deno-lint-ignore no-explicit-any\n    WebAssembly.instantiateStreaming == null ||\n        typeof (globalThis === null || globalThis === void 0 ? void 0 : globalThis.Deno) != null) {\n        return getArrayBuffer()\n            .then((buffer) => createFromBuffer(buffer));\n    }\n    else {\n        // deno-lint-ignore no-explicit-any\n        return WebAssembly\n            .instantiateStreaming(response, createImportObject())\n            .then((\n        // deno-lint-ignore no-explicit-any\n        obj) => createFromInstance(obj.instance));\n    }\n    function getArrayBuffer() {\n        if (isResponse(response)) {\n            return response.arrayBuffer();\n        }\n        else {\n            return response.then((response) => response.arrayBuffer());\n        }\n        function isResponse(response) {\n            return response.arrayBuffer != null;\n        }\n    }\n}\nexports.createStreaming = createStreaming;\n/**\n * Creates a formatter from the specified wasm module bytes.\n * @param wasmModuleBuffer - The buffer of the wasm module.\n */\nfunction createFromBuffer(wasmModuleBuffer) {\n    const wasmModule = new WebAssembly.Module(wasmModuleBuffer);\n    const wasmInstance = new WebAssembly.Instance(wasmModule, createImportObject());\n    return createFromInstance(wasmInstance);\n}\nexports.createFromBuffer = createFromBuffer;\n/**\n * Creates a formatter from the specified wasm instance.\n * @param wasmInstance - The WebAssembly instance.\n */\nfunction createFromInstance(wasmInstance) {\n    // deno-lint-ignore no-explicit-any\n    const wasmExports = wasmInstance.exports;\n    const { \n    // deno-lint-ignore camelcase\n    get_plugin_schema_version, \n    // deno-lint-ignore camelcase\n    set_file_path, \n    // deno-lint-ignore camelcase\n    set_override_config, \n    // deno-lint-ignore camelcase\n    get_formatted_text, format, \n    // deno-lint-ignore camelcase\n    get_error_text, \n    // deno-lint-ignore camelcase\n    get_plugin_info, \n    // deno-lint-ignore camelcase\n    get_resolved_config, \n    // deno-lint-ignore camelcase\n    get_config_diagnostics, \n    // deno-lint-ignore camelcase\n    set_global_config, \n    // deno-lint-ignore camelcase\n    set_plugin_config, \n    // deno-lint-ignore camelcase\n    get_license_text, \n    // deno-lint-ignore camelcase\n    get_wasm_memory_buffer, \n    // deno-lint-ignore camelcase\n    get_wasm_memory_buffer_size, \n    // deno-lint-ignore camelcase\n    add_to_shared_bytes_from_buffer, \n    // deno-lint-ignore camelcase\n    set_buffer_with_shared_bytes, \n    // deno-lint-ignore camelcase\n    clear_shared_bytes, \n    // deno-lint-ignore camelcase\n    reset_config, } = wasmExports;\n    const pluginSchemaVersion = get_plugin_schema_version();\n    const expectedPluginSchemaVersion = 3;\n    if (pluginSchemaVersion !== 2 &&\n        pluginSchemaVersion !== expectedPluginSchemaVersion) {\n        throw new Error(`Not compatible plugin. ` +\n            `Expected schema ${expectedPluginSchemaVersion}, ` +\n            `but plugin had ${pluginSchemaVersion}.`);\n    }\n    const bufferSize = get_wasm_memory_buffer_size();\n    let configSet = false;\n    return {\n        setConfig(globalConfig, pluginConfig) {\n            setConfig(globalConfig, pluginConfig);\n        },\n        getConfigDiagnostics() {\n            setConfigIfNotSet();\n            const length = get_config_diagnostics();\n            return JSON.parse(receiveString(length));\n        },\n        getResolvedConfig() {\n            setConfigIfNotSet();\n            const length = get_resolved_config();\n            return JSON.parse(receiveString(length));\n        },\n        getPluginInfo() {\n            var _a;\n            const length = get_plugin_info();\n            const pluginInfo = JSON.parse(receiveString(length));\n            pluginInfo.fileNames = (_a = pluginInfo.fileNames) !== null && _a !== void 0 ? _a : [];\n            return pluginInfo;\n        },\n        getLicenseText() {\n            const length = get_license_text();\n            return receiveString(length);\n        },\n        formatText(filePath, fileText, overrideConfig) {\n            setConfigIfNotSet();\n            if (overrideConfig != null) {\n                if (pluginSchemaVersion === 2) {\n                    throw new Error(\"Cannot set the override configuration for this old plugin.\");\n                }\n                sendString(JSON.stringify(overrideConfig));\n                set_override_config();\n            }\n            sendString(filePath);\n            set_file_path();\n            sendString(fileText);\n            const responseCode = format();\n            switch (responseCode) {\n                case 0: // no change\n                    return fileText;\n                case 1: // change\n                    return receiveString(get_formatted_text());\n                case 2: // error\n                    throw new Error(receiveString(get_error_text()));\n                default:\n                    throw new Error(`Unexpected response code: ${responseCode}`);\n            }\n        },\n    };\n    function setConfigIfNotSet() {\n        if (!configSet) {\n            setConfig({}, {});\n        }\n    }\n    function setConfig(globalConfig, pluginConfig) {\n        if (reset_config != null) {\n            reset_config();\n        }\n        sendString(JSON.stringify(globalConfig));\n        set_global_config();\n        sendString(JSON.stringify(pluginConfig));\n        set_plugin_config();\n        configSet = true;\n    }\n    function sendString(text) {\n        const encoder = new TextEncoder();\n        const encodedText = encoder.encode(text);\n        const length = encodedText.length;\n        clear_shared_bytes(length);\n        let index = 0;\n        while (index < length) {\n            const writeCount = Math.min(length - index, bufferSize);\n            const wasmBuffer = getWasmBuffer(writeCount);\n            for (let i = 0; i < writeCount; i++) {\n                wasmBuffer[i] = encodedText[index + i];\n            }\n            add_to_shared_bytes_from_buffer(writeCount);\n            index += writeCount;\n        }\n    }\n    function receiveString(length) {\n        const buffer = new Uint8Array(length);\n        let index = 0;\n        while (index < length) {\n            const readCount = Math.min(length - index, bufferSize);\n            set_buffer_with_shared_bytes(index, readCount);\n            const wasmBuffer = getWasmBuffer(readCount);\n            for (let i = 0; i < readCount; i++) {\n                buffer[index + i] = wasmBuffer[i];\n            }\n            index += readCount;\n        }\n        const decoder = new TextDecoder();\n        return decoder.decode(buffer);\n    }\n    function getWasmBuffer(length) {\n        const pointer = get_wasm_memory_buffer();\n        return new Uint8Array(\n        // deno-lint-ignore no-explicit-any\n        wasmInstance.exports.memory.buffer, pointer, length);\n    }\n}\nexports.createFromInstance = createFromInstance;\n","/// <reference lib=\"webworker\" />\nimport { createFromBuffer, Formatter } from \"@dprint/formatter\";\n\nlet formatter: Promise<Formatter> | undefined;\nlet config: Record<string, unknown> | undefined;\nlet nextFormat: { filePath: string; fileText: string } | undefined;\nlet abortController = new AbortController();\n\nonmessage = function(e) {\n  switch (e.data.type) {\n    case \"LoadUrl\": {\n      loadUrl(e.data.url);\n      break;\n    }\n    case \"SetConfig\": {\n      setConfig(e.data.config);\n      break;\n    }\n    case \"Format\": {\n      format(e.data.filePath, e.data.fileText);\n      break;\n    }\n  }\n};\n\nfunction loadUrl(url: string) {\n  abortController.abort();\n  abortController = new AbortController();\n  const signal = abortController.signal;\n  formatter = fetch(url, { signal })\n    .then(response => response.arrayBuffer())\n    .then(wasmModuleBuffer => {\n      const newFormatter = createFromBuffer(wasmModuleBuffer);\n\n      postPluginInfo(newFormatter);\n\n      if (config) {\n        setConfigSync(newFormatter, config);\n      }\n\n      if (nextFormat) {\n        formatSync(newFormatter, nextFormat.filePath, nextFormat.fileText);\n      }\n\n      return newFormatter;\n    });\n\n  formatter.catch((err: any) => {\n    if (!signal.aborted) {\n      postError(err);\n    }\n  });\n}\n\nfunction setConfig(providedConfig: Record<string, unknown>) {\n  config = providedConfig;\n  refresh();\n}\n\nfunction refresh() {\n  if (formatter) {\n    formatter.then(f => {\n      if (config) {\n        setConfigSync(f, config);\n      }\n      if (nextFormat) {\n        formatSync(f, nextFormat.filePath, nextFormat.fileText);\n      }\n    });\n  }\n}\n\nfunction format(filePath: string, fileText: string) {\n  nextFormat = { filePath, fileText };\n\n  if (formatter) {\n    formatter.then(f => formatSync(f, filePath, fileText));\n  }\n}\n\nfunction setConfigSync(f: Formatter, config: Record<string, unknown>) {\n  doHandlingError(() => f.setConfig({}, config));\n}\n\nfunction formatSync(f: Formatter, filePath: string, fileText: string) {\n  let result;\n  try {\n    result = f.formatText(filePath, fileText);\n  } catch (err: any) {\n    result = err.message;\n  }\n  postMessage({\n    type: \"Format\",\n    text: result,\n  });\n}\n\nfunction postPluginInfo(f: Formatter) {\n  postMessage({\n    type: \"PluginInfo\",\n    info: f.getPluginInfo(),\n  });\n}\n\nfunction doHandlingError(action: () => void) {\n  try {\n    action();\n  } catch (err: any) {\n    postError(err);\n  }\n}\n\nfunction postError(err: Error) {\n  postMessage({\n    type: \"Error\",\n    message: err.message,\n  });\n}\n"],"sourceRoot":""}